import{QueryClient as e,isCancelledError as t,QueryObserver as r,InfiniteQueryObserver as n,MutationObserver as o}from"@tanstack/query-core";import{atom as s}from"jotai/vanilla";import{atomWithObservable as i}from"jotai/vanilla/utils";const c=s(new e);"production"!==process.env.NODE_ENV&&(c.debugPrivate=!0);const u=(e,r,n,o)=>{const c=s(()=>new WeakMap);"production"!==process.env.NODE_ENV&&(c.debugPrivate=!0);const u=s(0);"production"!==process.env.NODE_ENV&&(u.debugPrivate=!0);const a=Symbol(),d=s(t=>{t(u);const o=r(t),s=e(t),i=t(c);let d=i.get(o);return d?(d[a]=!0,d.setOptions(s),delete d[a]):(d=n(o,s),i.set(o,d)),d});"production"!==process.env.NODE_ENV&&(d.debugPrivate=!0);const p=s(t=>{const r=e(t),n=t(d),o={subscribe:e=>{const t=t=>{const r=()=>e.next(t);n[a]?Promise.resolve().then(r):r()},o=n.subscribe(t),s=n.getCurrentResult(),i=null==n.getOptimisticResult?void 0:n.getOptimisticResult(r);return t(null==s||!s.dataUpdatedAt||null==i||!i.dataUpdatedAt||(null==s?void 0:s.dataUpdatedAt)>=(null==i?void 0:i.dataUpdatedAt)?s:i),{unsubscribe:o}}},s=i(()=>o,{initialValue:n.getCurrentResult()});return"production"!==process.env.NODE_ENV&&(s.debugPrivate=!0),s});"production"!==process.env.NODE_ENV&&(p.debugPrivate=!0);const v=s(e=>{const t=e(p);return e(t)},(e,t,n)=>{const s=e(d);return o(n,s,()=>{const n=r(e);e(c).delete(n),t(u,e=>e+1)})}),l=s(r=>{const n=e(r),o=r(d),s={subscribe:e=>{const r=r=>{if(r.isSuccess&&void 0!==r.data||r.isError&&!t(r.error)){const t=()=>e.next(r);o[a]?Promise.resolve().then(t):t()}},s=o.subscribe(r),i=o.getCurrentResult(),c=null==o.getOptimisticResult?void 0:o.getOptimisticResult(n);return r(null==i||!i.dataUpdatedAt||null==c||!c.dataUpdatedAt||(null==i?void 0:i.dataUpdatedAt)>=(null==c?void 0:c.dataUpdatedAt)?i:c),{unsubscribe:s}}},c=i(()=>s);return"production"!==process.env.NODE_ENV&&(c.debugPrivate=!0),c});"production"!==process.env.NODE_ENV&&(l.debugPrivate=!0);const b=e=>{if(e.error)throw e.error;return e.data};return[s(e=>{const t=e(l),r=e(t);return r instanceof Promise?r.then(b):b(r)},(e,t,r)=>t(v,r)),v]};function a(e,t=(e=>e(c))){return u(e,t,(e,t)=>new r(e,t),(e,t,r)=>{if("refetch"===e.type)return e.force?(t.remove(),void r()):t.refetch(e.options)})}function d(e,t=(e=>e(c))){return u(e,t,(e,t)=>new n(e,t),(e,t,r)=>"refetch"===e.type?e.force?(t.remove(),void r()):t.refetch(e.options):"fetchNextPage"===e.type?t.fetchNextPage():"fetchPreviousPage"===e.type?t.fetchPreviousPage():void 0)}function p(e,t=(e=>e(c))){return u(e,t,(e,t)=>new o(e,t),(e,t)=>t.mutate(...e))}function v(e,n=(e=>e(c))){return((e,n,o,c)=>{const u=s(()=>new WeakMap);"production"!==process.env.NODE_ENV&&(u.debugPrivate=!0);const a=s(0);"production"!==process.env.NODE_ENV&&(a.debugPrivate=!0);const d=Symbol(),p=s(async t=>{t(a);const o=await e(t),s=n(t),i=t(u);let c=i.get(s);return c?(c[d]=!0,c.setOptions(o),delete c[d]):(c=((e,t)=>new r(e,t))(s,o),i.set(s,c)),c});"production"!==process.env.NODE_ENV&&(p.debugPrivate=!0);const v=s(async e=>{const t=await e(p),r={subscribe:e=>{const r=r=>{const n=()=>e.next(r);t[d]?Promise.resolve().then(n):n()},n=t.subscribe(r);return r(t.getCurrentResult()),{unsubscribe:n}}},n=i(()=>r,{initialValue:t.getCurrentResult()});return"production"!==process.env.NODE_ENV&&(n.debugPrivate=!0),n});"production"!==process.env.NODE_ENV&&(v.debugPrivate=!0);const l=s(async e=>{const t=await e(v);return e(t)},async(e,t,r)=>{const o=await e(p);return await(async(r,o,s)=>{if("refetch"===r.type)return r.force?(o.remove(),void(()=>{const r=n(e);e(u).delete(r),t(a,e=>e+1)})()):await o.refetch(r.options)})(r,o)}),b=s(async r=>{e(r);const n=await r(p),o={subscribe:e=>{const r=r=>{if(r.isSuccess&&void 0!==r.data||r.isError&&!t(r.error)){const t=()=>e.next(r);n[d]?Promise.resolve().then(t):t()}},o=n.subscribe(r);return r(n.getCurrentResult()),{unsubscribe:o}}},s=i(()=>o);return"production"!==process.env.NODE_ENV&&(s.debugPrivate=!0),s});"production"!==process.env.NODE_ENV&&(b.debugPrivate=!0);const E=e=>{if(e.error)throw e.error;return e.data};return[s(async e=>{const t=await e(b),r=await e(t);return r instanceof Promise?r.then(E):await E(r)},(e,t,r)=>t(l,r)),l]})(e,n)}export{d as atomsWithInfiniteQuery,p as atomsWithMutation,a as atomsWithQuery,v as atomsWithQueryAsync,c as queryClientAtom};
//# sourceMappingURL=index.modern.mjs.map
